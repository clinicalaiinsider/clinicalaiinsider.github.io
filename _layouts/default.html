<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: page.excerpt | default: site.description | strip_html | truncate: 160 }}">
    
    {% if page.author %}<meta name="author" content="{{ page.author }}">{% endif %}
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title | default: site.title }}">
    <meta property="og:description" content="{{ page.description | default: page.excerpt | default: site.description | strip_html | truncate: 160 }}">
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    {% if page.image %}<meta property="og:image" content="{{ page.image | absolute_url }}">{% endif %}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title | default: site.title }}">
    <meta name="twitter:description" content="{{ page.description | default: page.excerpt | default: site.description | strip_html | truncate: 160 }}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,400;8..60,500;8..60,600;8..60,700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}?v={{ site.time | date: '%s' }}">

    <!-- Visual Storytelling Components -->
    <link rel="stylesheet" href="{{ '/assets/css/visual-storytelling.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/visual-storytelling-expanded.css' | relative_url }}">

    <!-- Mermaid (conditional) -->
    {% if page.mermaid %}
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#f3f4f6',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#e5e7eb',
                lineColor: '#9ca3af',
                secondaryColor: '#f9fafb',
                fontFamily: 'Inter, sans-serif'
            }
        });
    </script>
    {% endif %}
    
    <!-- MathJax (conditional) -->
    {% if page.mathjax %}
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    {% endif %}
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | relative_url }}">
    
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ '/feed.xml' | relative_url }}">
    
    <!-- Canonical -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">
</head>
<body>
    
    {% include header.html %}
    
    <main class="{% if page.layout == 'home' %}main-home{% else %}container{% endif %}">
        {{ content }}
    </main>
    
    {% include footer.html %}

    {% include scroll-nav.html %}

</body>
</html>
